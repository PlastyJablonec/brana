# üîß KONFIGURACE - Gate Control System

## üìã RYCHL√ù START

### 1. **Povinn√° konfigurace `.env` souboru**

```bash
# Zkop√≠ruj template:
cp .env.example .env

# Uprav n√°sleduj√≠c√≠ hodnoty:
nano .env
```

### 2. **Kompletn√≠ `.env` konfigurace:**

```bash
# Build info (auto-generated by npm run build)
REACT_APP_BUILD_TIME=auto-generated
REACT_APP_VERSION=auto-generated  
REACT_APP_COMMIT_HASH=auto-generated

# ===== MQTT KONFIGURACE (POVINN√â!) =====
# POZOR: Bez t√©to konfigurace bƒõ≈æ√≠ aplikace v MOCK re≈æimu!

# WebSocket MQTT pro HTTP p≈ôipojen√≠:
REACT_APP_MQTT_URL=ws://192.168.1.100:9001

# WebSocket Secure MQTT pro HTTPS p≈ôipojen√≠:
REACT_APP_MQTT_WSS_URL=wss://192.168.1.100:9002

# MQTT autentifikace (voliteln√©):
REACT_APP_MQTT_USERNAME=username
REACT_APP_MQTT_PASSWORD=password

# ===== FIREBASE KONFIGURACE (POVINN√â!) =====
# Zkop√≠ruj hodnoty z brana.json souboru:

REACT_APP_FIREBASE_API_KEY=AIzaSyB7f6hVmYeXmF9kLGwXPcUAWy8Ft_cApHE
REACT_APP_FIREBASE_AUTH_DOMAIN=brana-a71fe.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=brana-a71fe
REACT_APP_FIREBASE_STORAGE_BUCKET=brana-a71fe.firebasestorage.app
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=100155818288533404366
REACT_APP_FIREBASE_APP_ID=1:100155818288533404366:web:your-app-id

# ===== KAMERA KONFIGURACE (VOLITELN√â) =====
REACT_APP_CAMERA_URL=http://192.168.1.100:8080
```

---

## üîç ZJI≈†TƒöN√ç IP ADRES

### **Najdi IP adresu Raspberry Pi (MQTT broker):**
```bash
# Na Raspberry Pi s MQTT brokerem:
hostname -I
# nebo
ip route | grep default | awk '{print $3}'
```

### **Najdi IP adresu kamery:**
```bash
# Skenuj s√≠≈• (na Linuxu):
nmap -sn 192.168.1.0/24

# Nebo zkus obvykl√© IP:
ping 192.168.1.1    # router/gateway
ping 192.168.1.100  # obvykl√° IP kamery
ping 192.168.1.200  # obvykl√° IP pi
```

### **Testuj dostupnost slu≈æeb:**
```bash
# Test MQTT WebSocket:
telnet 192.168.1.100 9001

# Test kamery:
curl -I http://192.168.1.100:8080/camera.jpg
```

---

## üåê MQTT TOPICS (Protokol komunikace)

### **Odchoz√≠ p≈ô√≠kazy (z aplikace):**
```
IoT/Brana/Ovladani
‚îú‚îÄ‚îÄ "1" ‚Üí Ovl√°d√°n√≠ br√°ny (otev≈ô√≠t/zav≈ô√≠t)
‚îú‚îÄ‚îÄ "3" ‚Üí Ovl√°d√°n√≠ gar√°≈æe  
‚îî‚îÄ‚îÄ "6" ‚Üí STOP re≈æim (nouzov√© zastaven√≠)
```

### **P≈ô√≠choz√≠ stavy (do aplikace):**
```
IoT/Brana/Status    ‚Üí Stav br√°ny ("otev≈ôena"/"zav≈ôena"/"pohyb")
IoT/Brana/Status2   ‚Üí Stav gar√°≈æe ("otev≈ôena"/"zav≈ôena")
```

### **Logov√°n√≠ (z aplikace):**
```
Log/Brana/ID ‚Üí Logov√°n√≠ akc√≠ u≈æivatel≈Ø
Log/Brana/Disconnect ‚Üí Info o odpojen√≠ klienta
```

---

## üîß MQTT BROKER KONFIGURACE

### **Mosquitto konfigurace (`mosquitto.conf`):**
```conf
# Z√°kladn√≠ MQTT listener
listener 1883
protocol mqtt

# WebSocket listener pro webov√© aplikace
listener 9001  
protocol websockets

# WebSocket Secure listener pro HTTPS
listener 9002
protocol websockets
cafile /path/to/ca.crt
certfile /path/to/server.crt
keyfile /path/to/server.key

# Autentifikace (voliteln√©)
allow_anonymous false
password_file /etc/mosquitto/passwd

# Bezpeƒçnost
max_connections 100
max_inflight_messages 20
```

### **Firewall nastaven√≠:**
```bash
# Ubuntu/Debian:
sudo ufw allow 1883/tcp  # MQTT
sudo ufw allow 9001/tcp  # WebSocket
sudo ufw allow 9002/tcp  # WebSocket Secure

# CentOS/RHEL:
sudo firewall-cmd --add-port=1883/tcp --permanent
sudo firewall-cmd --add-port=9001/tcp --permanent  
sudo firewall-cmd --add-port=9002/tcp --permanent
sudo firewall-cmd --reload
```

---

## üì∑ KAMERA KONFIGURACE

### **Podporovan√© kamery:**
- IP kamery s MJPEG streamem
- USB kamery p≈ôipojen√© k Pi s `motion` nebo `mjpg-streamer`
- RTSP kamery (s proxy serverem)

### **Obvykl√© URL form√°ty:**
```bash
# IP kamera MJPEG:
http://192.168.1.100:8080/camera.jpg
http://admin:password@192.168.1.100/mjpeg

# mjpg-streamer na Pi:  
http://192.168.1.100:8080/?action=stream
http://192.168.1.100:8080/?action=snapshot

# Motion daemon:
http://192.168.1.100:8081/current.jpg
```

### **CORS probl√©my:**
Pokud kamera blokuje p≈ô√≠stup z webov√© aplikace, nastav v kame≈ôe:
```
Access-Control-Allow-Origin: *
```

Nebo pou≈æij proxy server v `public/camera-proxy.html`.

---

## üîí FIREBASE KONFIGURACE  

### **Z√≠sk√°n√≠ konfigurace:**
1. Jdi na [Firebase Console](https://console.firebase.google.com/)
2. Vyber projekt `brana-a71fe`
3. Project Settings > General > Your apps > Web app
4. Zkop√≠ruj config do `.env`

### **Aktivovan√© slu≈æby:**
- **Authentication:** Email/Password + Google OAuth
- **Firestore:** NoSQL datab√°ze pro u≈æivatele a logy
- **Storage:** Pro upload fotek (voliteln√©)

### **Firestore Collections:**
```
users/           ‚Üí U≈æivatel√© a opr√°vnƒõn√≠
  ‚îú‚îÄ‚îÄ [uid]      ‚Üí Dokument u≈æivatele
  ‚îî‚îÄ‚îÄ permissions ‚Üí Opr√°vnƒõn√≠ (gate, garage, camera...)

activities/      ‚Üí Logy aktivit  
  ‚îî‚îÄ‚îÄ [id]       ‚Üí Z√°znam akce (user, timestamp, action)

settings/        ‚Üí Konfigurace aplikace
  ‚îî‚îÄ‚îÄ app_settings ‚Üí Glob√°ln√≠ nastaven√≠
```

---

## üöÄ DEPLOYMENT KONFIGURACE

### **Development (.env.local):**
```bash
REACT_APP_MQTT_URL=ws://localhost:9001
REACT_APP_CAMERA_URL=http://localhost:8080
```

### **Production (.env.production):**  
```bash
REACT_APP_MQTT_WSS_URL=wss://your-domain.com:9002
REACT_APP_CAMERA_URL=https://your-domain.com:8080
```

### **Vercel/Netlify Environment Variables:**
Nastav v≈°echny `REACT_APP_*` promƒõnn√© p≈ôes webov√© rozhran√≠ provideru.

---

## ‚úÖ OVƒö≈òEN√ç KONFIGURACE

### **Kontroln√≠ seznam:**
```bash
# 1. .env soubor existuje:
ls -la .env

# 2. Obsahuje MQTT URL:  
grep REACT_APP_MQTT_URL .env

# 3. Obsahuje Firebase config:
grep REACT_APP_FIREBASE_PROJECT_ID .env

# 4. MQTT broker dostupn√Ω:
ping mqtt-broker-ip
telnet mqtt-broker-ip 9001

# 5. Kamera dostupn√°:
curl -I camera-ip:8080

# 6. Build projde bez chyb:
npm run build

# 7. Console neobsahuje "Mock":
npm start
# Otev≈ôi Developer Tools > Console
# NESM√ç obsahovat: "üîß Mock MQTT" nebo "üîß Mock Firebase"
```

### **Debug informace:**
```javascript
// V browser konzoli:
localStorage.setItem('mqtt-debug', 'true');
localStorage.setItem('debug', 'true');

// Reload str√°nky a sleduj detailn√≠ logy
```

---

## üìû PODPORA

**P≈ôed kontaktov√°n√≠m podpory zkontroluj:**
1. Console logy (F12 > Console)
2. Network logy (F12 > Network > WS)  
3. `.env` konfigurace (bez citliv√Ωch dat)

**GitHub Issues:** https://github.com/PlastyJablonec/brana/issues

---

*Posledn√≠ aktualizace: 2025-08-04*  
*Verze dokumentace: 2.14.0*